# 微信小程序学习第10天

## 每日反馈

作业都检查过，抽取有代表性的

1. https://gitee.com/tqingtu/uni-yougou/blob/shop/src/pages/search_list/search_list.vue
   1. git远程仓库的默认分支应该是master
   2. 合适的变量命名
   3. 判断是否是最后一页和是否请求中的逻辑分开
2. https://gitee.com/liaojolun/my-uni-yougou/blob/Fea_jolun_20200302/src/pages/search_list/search_list.vue
   1. 下拉刷新，在h5里面动画不会停止，需要添加`uni.stopPullDownRefresh()`
   2. 请求中锁住和最后一页不再发请求的逻辑，是否应收拢到queryGoodsList?
3. https://github.com/q190776912/yougou/blob/master/src/pages/search_list/search_list.vue
   1. 抽取了reset
   2. 一进入页面需要开启下拉刷新？
4. 胡悦和赵超的git仓库地址没提供？冯跃晖和杨栩没push代码？

## 回顾

1. 下拉刷新
2. 上拉加载
3. App的生命周期
4. Page的生命周期



## Tabbar的特点

![image-20200305213027312](assets/image-20200305213027312.png)

tabbar的作用: 让App有多入口

1. 没有配置在tabbar属性的里面的页面，不显示tabbar
2. 跳转到tabbar页面，用switchTab
3. 跳转到非tabbar页面，用navigateTo
4. Tab栏只会初始化第一个页面，第一次切换到某tab时才会初始化该Tab; 后续切换tab只会显示/隐藏
5. tab栏只要初始化了并不会销毁



## 页面栈

[传送门](https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/route.html)

在调试器的`AppData`查看当前活动页面，

使用 `getCurrentPages()` 函数获取当前页面栈 

思考：活动页面有两个，但是栈里面只有一个呢？

| 路由方式   | 页面栈表现                      | 方法                        | 当前页面 | 后页面        |
| ---------- | ------------------------------- | --------------------------- | -------- | ------------- |
| 打开新页面 | 新页面入栈                      | wx.navigateTo               | onHide   | onLoad,onShow |
| 页面返回   | 页面不断出栈，直到目标返回页    | 左上角返回，wx.navigateBack | onUnload | onShow        |
| Tab切换    | 页面全部出栈，只留下新的Tab页面 | wx.switchTab                |          |               |



## uniapp生命周期图

[uniapp的生命周期](https://uniapp.dcloud.io/collocation/frame/lifecycle)

1. uniapp应用生命周期和小程序一致
2. uniapp页面生命周期和小程序一致，不建议用vue的生命周期
3. uniapp组件的生命周期建议用vue的生命周期

## 场景值

[传送门](https://developers.weixin.qq.com/miniprogram/dev/reference/scene-list.html)

概念：小程序的入口，不同入口都有的标识，这个就是场景值

一般用作**事件上报**

1. 页面被访问的次数PV
2. 页面被不同用户访问的次数UV
3. 事件上报针对某一按钮

获取场景值：app.js onShow(){options. scene }



## 优购案例-搜索列表

#### 07. 搜索和过滤栏固定定位，不随着商品列表滚动

[onPageScroll](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onPageScroll-Object-object)

1. 绝对定位方案
   1. 上滑时，搜索和过滤栏不随商品列表滚动
      1. onPageScroll：isFixed=true
   2. 下拉刷新顶部loading
      1. onPullDownRefresh：isFixed:false
2. 粘性定位
   1. position:sticky相对于最近一个滚动容器
      1. 使用top,left,right,bottom定位

#### 08.无须在结构渲染的变量不要声明在data里面

1. pageNum
2. isRequest

#### 09.自测

1. 输入框输入关键字，商品列表展示第一页搜索商品
2. 下拉刷新，商品列表展示第一页搜索商品
3. 上拉加载，加载下一页商品
4. 分类页点击三级分类，输入框显示对应的三级分类的名称，商品列表展示第一页搜索数据



### 字体图标

[阿里矢量图标库](https://www.iconfont.cn/)

使用方法：

1. 搜索图标
2. 添加图标到购物车
3. 购物车里面添加进项目
4. 项目里生成在线代码

注意点

1. uniapp里面不支持网络路径样式引入



## 分享功能

[传送门](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/share.html)

[onShareAppMessage](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onShareAppMessage-Object-object)

分享当前页面

1. 添加一个组件button，设置属性open-type="share"
2. 用户点击按钮后触发 `Page.onShareAppMessage` 事件
3. onShareAppMessage的参数可以定制分享的弹窗内容
   1. title 标题，默认为当前小程序的名称
   2. imageUrl 图片，默认是一张随机图片
   3. path 转发路径（别人点你的分享链接，跳转的页面路径），默认当前页面路径



## 联系客服

[传送门](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/customer-message/customer-message.html)

1. 添加一个组件button，设置属性open-type="contact"

2. 后台需要接入客服系统

   

## 优购案例-商品详情页

<img src="../../%25E4%25BC%2598%25E8%25B4%25AD/assets/5-%25E5%2595%2586%25E5%2593%2581%25E8%25AF%25A6%25E6%2583%2585--goods_detail.PNG" alt="5-商品详情--goods_detail" style="zoom:50%;" />

#### 01.案例分析

1. 搜索列表的商品，点击可进入商品详情
2. 商品详情展示轮播图，可点击放大查看
3. 商品详情展示商品价格，名称，规格，送货地址及图文说明
4. 联系客服，加入购物车，或者直接购买。

#### 02.静态页面

1. 新建页面item
2. 商品详情页&搜索页跳转商品详情
3. 轮播图
4. 商品信息
5. **使用字体图标**
6. 促销区域
7. 图文介绍与商品参数头部
8. 图文介绍与商品参数头部切换逻辑
9. 固定底部

#### 03.获取数据&渲染数据

1. 获取数据

   1. 搜索列表页点击商品跳转商品详情，传入goodsId
   2. 根据接口请求商品详情
      1. 接口 `/api/public/v1/goods/detail?goods_id=${goodsId}`

2. 渲染数据

   1. 轮播图

      1. 字段`pics`

   2. 预览图片

      点击轮播图其中一张图片，会打开页面预览被点击图片，左右滑动可以预览其他图片

      1. 给轮播图片设置点击事件
      2. 调用wx.previewImage在新页面中全屏预览图片
         1. current当前显示图片的链接
         2. urls需要预览的图片链接列表
      3. 传入相应的参数

   3. 动态渲染商品价格和名称

   4. 渲染商品详情图文说明

      1. v-html支持只包含img标签html str
      2. 基本所的电商网站，商品详情的图文介绍，都是图片和简单的文字
      3. 经验分享：后台添加商品时，可以同时生成分享图片，获取商品详情时，返回分享图片url属性

   5. 分享功能

      1. 添加一个组件button，设置属性open-type="share"
      2. onShareAppMessage方法中设置标题
      3. 解决样式问题
         1. 定位
         2. 隐藏
      4. 预览扫码体验

   6. 联系客服功能

      1. 添加一个组件button，设置属性open-type="contact"
      2. 解决样式问题
         1. 定位
         2. 隐藏

      

## 计算属性setter

[传送门](https://cn.vuejs.org/v2/guide/computed.html#%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7%E7%9A%84-setter)

1. 计算属性默认的用法其实是计算属性的getter方法

2. 计算属性的setter方法里面可以获取到值变化

3. 如果不设置firstName或lastName，不会改变fullName的

4. 典型的应用场景是checkbox全选/全不选



#### 练习总结

1. 计算属性的set方法触发的条件是，计算属性的key有变化的时候



## Vue组件通信

#### 01.父传子

 1. 父组件使用子组件标签中添加属性并赋值

    ```html
    <child message="父传给子的值"></child>
    ```

 2. 子组件中props声明对应属性

    ```js
    Vue.component('child',{
        template:'#chlidTpl',
        props:['message']
    })
    ```

注意点：

1. 在HTML 中，驼峰命名prop名需要转换成等价的`-`分隔命名

2. vue文件中没有这个限制？？

   1. [传送门](https://cn.vuejs.org/v2/guide/components-props.html#Prop-%E7%9A%84%E5%A4%A7%E5%B0%8F%E5%86%99-camelCase-vs-kebab-case)

   ```html
   <child parent-msg="父传给子的值"></child>
   ```

3. 不应该在一个子组件内部改变 prop ，最好 定义一个data 属性并将这个 prop 用作其初始值 ，保持组件的单身数据流

   ```js
   props:['message'],
       data(){
       return{
           info:this.message
       }
   }
   ```

#### 02.父传子动态

```js
watch:{
    message(newValue){
        this.info = newValue
    }
}
```

#### 03.练习-父传子，动态传递对象

1. 基于vue-cli脚手架，快速原型开发
  2. 验证传属性时，能不能用驼峰，能够
  3. 父传子，传对象的话，子改对象会不会报错？？不会

##### 提示

1. vue serve需要安装`npm install -g @vue/cli-service-global`
2. 如果父传子是对象的话，初始化data属性需要clone object
3. 深度监听父传子的props



#### 04.子传父

1. 子组件中 $emit来触发一个自定义事件，并传递一个参数 

   ```js
   this.$emit('child-event','子传给父的消息')
   ```

2. 父组件里使用子标签中监听该自定义事件并添加一个响应该事件的处理方法 

   ```html
   <child @child-event="showChildMsg"></child>
   ```

注意点：

[事件名](https://cn.vuejs.org/v2/guide/components-custom-events.html#%E4%BA%8B%E4%BB%B6%E5%90%8D)

1. 推荐总是使用`-`分隔的方式命名事件名（.vue文件中没这种限制）

#### 05.子传父与v-model

1. 将其 `value` 特性绑定到一个名叫 `value` 的 prop 上 

   ```html
   <input type="text" :value="msg" @input="sendMsg2Parent">
   ```

2. 在其 `input` 事件被触发时，将新的值通过自定义的 `input` 事件抛出 

#### 06. $attrs 和$listeners使用

[传送门](https://cn.vuejs.org/v2/api/#vm-attrs)

方便爷组件和孙组件通信，透传

```html
<Son v-bind="$attrs" v-on="$listeners"/>
```



#### 07.兄弟通信

 eventBus我们只创建了一个新的Vue实例，以后它就承担起了组件之间通信的桥梁了，也就是中央事件总线。 

1. 组件1通过eventBus.$emit来触发一个自定义事件，并传递参数

   ```js
   eventBus.$emit('toChild2','组件1传给组件2的值')
   ```

   

2. 组件2通过尽早通过eventBus.$emit监听该自定义事件，并添加事件处理方法

   ```js
   create() {
       eventBus.$on('toChild2',function(data){
           console.log(data)
       })
   }
   ```



## 优购案例-搜索列表

#### 抽取头部输入框为单独的组件

1. search_list页面引入SearchBar.vue组件

2. SearchBar.vue组件中，输入框有内容就展示x按钮，没内容就不展示x按钮

   1. 获取输入内容v-model.trim:keyword
   2. 是否展示x按钮 v-show="keyword"

3. 点击x按钮清空输入框内容

   1. 事件@click:keyword=''

4. 设置输入框confirm-type="search"

5. 输入框回车，触发搜索商品

   1. SearchBar组件keyword不为空时，$emit一个query事件
   2. search_list页面注册一个@query事件，在事件里面触发搜索
   3. 触发搜索需要先设置keyword，再reload

6. 设置搜索列表的初始值

   1. SearchBar标签，绑定:query=“query”
   2. SearchBar组件，props接受query, data里面初始化keyword,**并watch**

7. 注意在mpvue里面，子改父props不会报错，但是还是建议遵从单向数据流的规范。

## 总结

## 作业