# 微信小程序学习第5天

## 说明

1. 上课只用QQ
2. 正式课程要心态收回来，好好学习
3. 进程放慢。以前2天的课程，现在3天来讲
4. 练习尽量当场完成吸收



## image组件的mode属性

 图片裁剪、缩放的模式 ,类似于background-size:cover

​	[传送门](https://developers.weixin.qq.com/miniprogram/dev/component/image.html)

1. 默认是scaleToFill:拉伸
2. aspectFit：保持宽高比，长边显示出来
3. aspectFill:保持宽高比，短边显示，长边截取
4. widthFix:保持宽高比，宽度不变，高度自动变化

如果需要显示的图片和image的宽度和高度比例是一致的话，无论什么模式效果是一样的。



## 优购案例-首页

#### 03.请求数据&渲染数据

1. 渲染轮播图部分
   
1. 接口：/api/public/v1/home/swiperdata
   
2. 渲染分类导航部分
   
   1. 接口：/api/public/v1/home/catitems
3. 渲染楼层部分
   
   1. 接口：/api/public/v1/home/floordata
   
   > content-type: application/json这种设置和后端有关
   >
   > 返回数据解析用解构语法
   

#### 04.wx.request封装

1. request.js封装wx.request

2. request设置到Vue原型上，Vue实例上都可以访问到$request

   1. 在main.js里设置

      ```js
      import request from '@/utils/request'
      Vue.prototype.$request = request
      ```

 3. 提取BASE_URL

#### 05.进一步优化

 1. async和await优化

      1. await作用是返回promise对象then里面的数据
      2. async作用有await的代码的function必须用async修饰
 2. 封装wx.request部分，添加loading

      1. 默认不传参且有loading，变量名为`noLoading`
      2. loading mask设置为true
 3. 导航栏背景色和颜色的全局设置

#### 注意点：

1. 后端返回的数据res.data.message，promise resolve 不要resolve(res)



## 优购案例-分类

<img src="assets/2-分类--category.PNG" alt="2-分类--category" style="zoom: 50%;" />

#### 01.页面分析

1. 点击分类Tab显示这个分类页面

 2. 点击搜索去到搜索页面
  3. 选中左侧其中一个一级分类，右侧显示对应的二级和三级分类

#### 02.静态页面

1. 将头部搜索区域封装为组件

   1. 组件的style需要加scoped，否则会影响到引入组件的页面

2. 主体部分需要占满剩下屏幕

   >内容滚动的条件是
   >
   >1. 父元素高度小于内容高度
   >2. 父元素高度确定
   >3. 父元素overflow:auto或者scroll

   ```css
     position: absolute;
     top: 100rpx;
     left: 0;
     right: 0;
     bottom: 0;
   ```

3. 左侧的结构

   1. 基本结构
   2. 选中的样式
   3. 点击切换选中元素

4. 右侧的结构

   1. 顶部图片展示

   2. 二级分类和三级分类结构



#### 03.获取数据&渲染数据

接口：/api/public/v1/categories

1. 获取数据
2. 渲染左侧
3. 渲染右侧二级
4. 渲染右侧三级

> 1. 写小程序或者App时，尽量减少标签层级。因为对应一个原生组件，比较消耗资源的
> 2. v-if用在请求没回来之前，不渲染数据的逻辑，这里不能用v-show来替代
> 3. 右侧二级三级分类的渲染categories[activeIndex]



#### 注意点

1. 忽略掉wx:key设置不正确的警告



## 下拉刷新

[传送门](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/page.html)

小程序为页面增加下拉组件，**下拉时触发方法**，在方法里面我们可以自定义逻辑，通常用来重新加载第一页数据

1. 在页面设置index.json

```json
"enablePullDownRefresh":true,
"backgroundTextStyle": "dark"
"backgroundColor":"#ccc"
```

2. 下拉会触发onPullDownRefresh，一般在这个方法里面**处理加载第一页的逻辑**

3. backgroundColor 窗口的背景色

4. backgroundTextStyle 下拉 loading 的样式 `dark` / `light`，默认是light



## 下拉刷新-计数器案例

1. 新建一个页面`pages/pulldown_counter/index`

2. 显示数字，点击按钮+，自增

3. index.json增加"enablePullDownRefresh":true

4. backgroundColor:"#ccc"及backgroundTextStyle :"dark"

   

需求：页面上显示一个数字，点击+数字自增，下拉刷新时，数字重置为0

> 手动停止下拉loading动画 wx.stopPulldownRefresh





## 上拉加载更多

[传送门](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/page.html)

小程序为页面增加上拉组件，**上拉到底前**触发方法，在方法里面我们可以自定义逻辑，通常应用在分页的场景中，加载下一页

1. 在页面设置index.json

```json
"onReachBottomDistance":50
```

2. 下拉到底前会触发[onReachBottom](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onreachbottom)

3. 注意点，只有有滚动条的时候，上拉才会被触发

4. 在onReachBottom方法里面，一般处理加载下一页的逻辑

   
