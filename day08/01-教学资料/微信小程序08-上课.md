# 微信小程序学习第7天

## 每日反馈

1. 老师，你晚上github查看代码的工具是什么
   1.  chrome插件octotree
2. 讲的详细，也很有耐心
3. 搜索列表拉到最后一页 切换其它搜索列表会出现无法请求数据， 在onLaod 中也需要加 this.isLasPage = false， 那么onLoad中 直接可以写reload方法 在其上面保留关键字变量keyword
   1. 是的



## 回顾

1.  数据缓存

   1. wx.setStorage, wx.getStorage, wx.removeStorage，wx.clearStorage
   2. storage的存取本质上是对文件的读写，所以是异步的。
   3. 同步的API, 加Sync
      1. 类比于await promise
      2. 或者fs.readFileSync

   

## Vue组件通信

#### 01.父传子

 1. 父组件使用子组件标签中添加属性并赋值

    ```html
    <child message="父传给子的值"></child>
    ```

 2. 子组件中props声明对应属性

    ```js
    Vue.component('child',{
        template:'#chlidTpl',
        props:['message']
    })
    ```

注意点：

1. 在HTML 中，驼峰命名prop名需要转换成等价的`-`分隔命名

2. vue文件中没有这个限制？？

   1. [传送门](https://cn.vuejs.org/v2/guide/components-props.html#Prop-%E7%9A%84%E5%A4%A7%E5%B0%8F%E5%86%99-camelCase-vs-kebab-case)

   ```html
   <child parent-msg="父传给子的值"></child>
   ```

3. 不应该在一个子组件内部改变 prop ，最好 定义一个data 属性并将这个 prop 用作其初始值 

   ```js
   props:['message'],
       data(){
       return{
           info:this.message
       }
   }
   ```

#### 02.父传子动态

```js
watch:{
    message(newValue){
        this.info = newValue
    }
}
```

#### 03.练习-父传子，动态传递对象

1. 基于vue-cli脚手架，快速原型开发
 	2.  验证传属性时，能不能用驼峰，能够
  3. 父传子，传对象的话，子改对象会不会报错？

##### 提示

1. vue serve需要安装`npm install -g @vue/cli-service-global`
2. 如果父传子是对象的话，初始化data属性需要clone object
3. 深度监听父传子的props

#### 04.子传父

1. 子组件中 $emit来触发一个自定义事件，并传递一个参数 

   ```js
   this.$emit('child-event','子传给父的消息')
   ```

2. 父组件里使用子标签中监听该自定义事件并添加一个响应该事件的处理方法 

   ```html
   <child @child-event="showChildMsg"></child>
   ```

注意点：

[事件名](https://cn.vuejs.org/v2/guide/components-custom-events.html#%E4%BA%8B%E4%BB%B6%E5%90%8D)

1. 推荐总是使用`-`分隔的方式命名事件名（.vue文件中没这种限制）

#### 05.子传父与v-model

1. 将其 `value` 特性绑定到一个名叫 `value` 的 prop 上 

   ```html
   <input type="text" :value="msg" @input="sendMsg2Parent">
   ```

2. 在其 `input` 事件被触发时，将新的值通过自定义的 `input` 事件抛出 

#### 06. $attrs 和$listeners使用

[传送门](https://cn.vuejs.org/v2/api/#vm-attrs)

方便爷组件和孙组件通信，透传

```html
<Son v-bind="$attrs" v-on="$listeners"/>
```



#### 07.兄弟通信

 eventBus我们只创建了一个新的Vue实例，以后它就承担起了组件之间通信的桥梁了，也就是中央事件总线。 

1. 组件1通过eventBus.$emit来触发一个自定义事件，并传递参数

   ```js
   eventBus.$emit('toChild2','组件1传给组件2的值')
   ```

   

2. 组件2通过尽早通过eventBus.$emit监听该自定义事件，并添加事件处理方法

   ```js
   create() {
       eventBus.$on('toChild2',function(data){
           console.log(data)
       })
   }
   ```



## 优购案例-搜索列表

#### 抽取头部输入框为单独的组件

1. search_list页面引入SearchBar.vue组件

2. SearchBar.vue组件中，输入框有内容就展示x按钮，没内容就不展示x按钮

   1. 获取输入内容v-model.trim:keyword
   2. 是否展示x按钮 v-show="keyword"

3. 点击x按钮清空输入框内容

   1. 事件@click:keyword=''

4. 设置输入框confirm-type="search"

5. 输入框回车，触发搜索商品

   1. SearchBar组件keyword不为空时，$emit一个query事件
   2. search_list页面注册一个@query事件，在事件里面触发搜索
   3. 触发搜索需要先设置keyword，再reload

6. 设置搜索列表的初始值

   1. SearchBar标签，绑定:query=“query”
   2. SearchBar组件，props接受query, data里面初始化keyword,**并watch**

   

## 优购案例-搜索页面

<img src="assets/7-搜索.PNG" alt="7-搜索" style="zoom:33%;" />

#### 01.页面分析

1. 首页和分类页搜索热区，点击跳转到搜索页面
2. 输入框输入，点键盘右下搜索，去到搜索列表页
3. 点历史搜索关键字，去到搜索列表页
4. 搜索历史记录存储到storage
5. 输入框中有内容就展示x，点击x清除内容

#### 02.静态页面

1. 新建搜索页search
2. 搜索顶部
3. 历史搜索

#### 03.基本逻辑

1. 首页和分类页搜索热区，点击跳转到搜索页面
2. 输入框回车，跳转到搜索列表页
   1. 搜索页面注册事件@query:toSearchList
   2. 跳转到搜索列表页 /pages/search_list/main?query=${data}
3. 展示历史搜索列表，存储在storage中
   1. data里面从storage中取数据`keywordList`
   2. 渲染列表
4. 点击回车，历史搜索列表头部添加关键字，并保存
   1. 事件@query:toSearchList处理
   2. unshift给数组头部插入关键字
   3. 数组不能重复使用filter过滤
      1. 更好的方法用Set
   4. 存储到storage wx.setStorageSync
5. 页面返回时才显示添加的关键字
   1. 页面onShow时,keywordList从storage里面取
6. 点击历史搜索列表元素，跳转到搜索列表页, 同时元素添加到头部
   1. 元素点击事件@click:toSearchList(item)
   3. 跳转wx.navigateTo
   4. 数组在头部添加关键字，然后去重
   4. 然后存储
   5. onShow时，keywordList从storage里面取
7. 点击x的时候，清除搜索历史
   1. 事件@click：clearKeywordList
   2. 清除keywordList和storage
   3. 确认弹框wx.showModal
8. 返回页面清空输入框
   1. 父组件给子组件传递query=''
   2. onHide时候设置query=''
   3. 触发搜索时，设置父组件的query
