# 微信小程序学习第9天

## 每日反馈&&作业检查

1. https://gitee.com/guo_yuan_tian/uni-yougou/tree/yougou/
2. https://gitee.com/liaojolun/my-uni-yougou/tree/Fea_jolun_20200302/
   1. 计算属性多一次遍历
3. https://gitee.com/tqingtu/uni-yougou.git
4.  https://gitee.com/luckyblue07006/my-yougou-mall/tree/blue_0302/
5. https://gitee.com/xintingzheng/uni-yougou/blob/ZXT-uni-yougou/
6. https://gitee.com/qingyo/yougou/tree/home/
7. https://gitee.com/phxgitgeehello/uni-yougou/tree/master/
8. 非内置浏览器运行项目会有跨域问题

## 回顾

1. 首页静态页面+渲染
2. uni.request的封装
3. 分类页面的静态页面
4. 分类页面的渲染

## 下拉刷新-计数器案例

1. 新建一个页面`pages/pulldown_counter/index`

2. 显示数字，点击按钮+，自增

3. index.json增加"enablePullDownRefresh":true

4. backgroundColor:"#ccc"及backgroundTextStyle :"dark"

   

需求：页面上显示一个数字，点击+数字自增，下拉刷新时，数字重置为0

> 手动停止下拉loading动画 wx.stopPulldownRefresh





## 上拉加载更多

[传送门](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/page.html)

小程序为页面增加上拉组件，**上拉到底前**触发方法，在方法里面我们可以自定义逻辑，通常应用在分页的场景中，加载下一页

1. 在页面设置index.json

```json
"onReachBottomDistance":50
```

2. 下拉到底前会触发[onReachBottom](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onreachbottom)

3. 注意点，只有有滚动条的时候，上拉才会被触发

4. 在onReachBottom方法里面，一般处理加载下一页的逻辑

   

## 练习-下拉上拉-综合案例

参考<https://dev.dcloud.net.cn/mui/>

1. 新建一个页面，展示列表。

2. index.json配置开启上拉加载和下拉刷新

3. 在上拉加载里面，添加数据。下拉刷新里面加载第一页。

   ```js
    setTimeout(() => {
        this.setData({
            list: numArr
        })
        //主动结束下拉刷新
        wx.stopPullDownRefresh();
    }, 500)
   ```



## 优购案例-搜索列表

<img src="../../%25E4%25BC%2598%25E8%25B4%25AD/assets/7-%25E6%2590%259C%25E7%25B4%25A2%25E5%2595%2586%25E5%2593%2581%25E5%2588%2597%25E8%25A1%25A8--goods_list.PNG" alt="7-搜索商品列表--goods_list" style="zoom:50%;" />

#### 01.页面分析


1. 点击三级分类，去到搜索列表页面，传递cat_name
2. 获取列表数据的接口是查询关键字，支持分页
  3. 下拉刷新，上拉加载更多
  4. 输入框输入关键字，搜索
  5. 点击其中一个商品跳转商品详情

#### 02.静态页面

2. 新建页面search_list
3. 标题设置为`搜索结果`
4. 头部搜索功能
5. 过滤栏综合销量及价格展示
6. 过滤栏点击选中功能
7. 商品列表展示

#### 03.基本逻辑

1. 过滤栏点击某一项添加选中样式
   1. 声明一个过滤栏菜单数组
   2. 点击activeIndex=index
   3. 选中即添加active样式
2. 点击三级分类，去到搜索列表页面
   1. 点击跳转 @click="toSearchList"
      1. wx.navigatorTo()
      2. 传递cat_name
   2. 在搜索列表页面上获取参数
      1. 在onLoad方法里面 参数

#### 04.请求数据&渲染数据

1. onLoad设置keyword, 请求数据queryGoods
   2. 接口 /api/public/v1/goods/search
   3. 参数
      1. query关键字
      2. pagesize每页多少条
      3. pagenum 页码(从1开始)
2. 渲染数据
3. 输入框输入关键字，确定的时候触发搜索商品
   1. 获取输入框的输入keyword
   2. 点击确定触发搜索@confirm:queryGoods

#### 05.下拉刷新

1. 配置开启下拉刷新, 并配置样式

   ```
     "enablePullDownRefresh": true,
     "backgroundColor": "#eee",
     "backgroundTextStyle": "dark"
   ```

2. 触发下拉刷新事件重新请求数据

   1. onPullDownRefresh方法里
      1. 重置goodsList
      2. 发请求

#### 06.上拉加载更多

1. 配置开启上拉 "onReachBottomDistance":50
2. 上拉触底后给当前页+1，再请求
   1. onReachBottom方法里页码+1, 再请求
   2. 商品列表应该是追加，而不是覆盖

#### 07.优化

1. 输入框确定、下拉刷新，搜索结果为第一页
   1. 搜索结果为首页，单独抽取一个方法reload
   2. reload重置页码为1，重置goodsList

2. 当请求中，不再发请求
   1. 设置请求中状态isRequest
   2. 请求前，为true
   3. 请求后为false
   4. 如果为true时，return
3. 如果当前是最后一页，不再发请求
   1. 是否为最后一页的状态isLastPage
   2. 如果是最后一页，不再发请求
4. 添加一个有加载完成的提示
   1. isLastPage为true时显示



## 小程序生命周期钩子

#### 01.App生命周期

[传送门](https://developers.weixin.qq.com/miniprogram/dev/reference/api/App.html)

1. App在初始化，切前台后台时会以回调函数的形式通知我们

   | 钩子函数 | 说明                             |
   | -------- | -------------------------------- |
   | onLaunch | 小程序初始化时触发（只触发一次） |
   | onShow   | 从后台进入前台                   |
   | onHide   | 从前台进入后台                   |



#### 02.Page生命周期

[Page生命周期](https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/page-life-cycle.html)

Page在加载、显示、渲染完成、隐藏和销毁时会以回调函数的形式通知我们

| 钩子函数 | 说明             | 备注 |
| -------- | ---------------- | ---- |
| onLoad   | 页面加载         |      |
| onShow   | 页面显示         |      |
| onReady  | 页面初次渲染完成 |      |
| onHide   | 页面隐藏         |      |
| onUnload | 页面销毁         |      |

> window.onload
>
> document.onDomContentLoaded



#### 03.页面栈的概念

[传送门](https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/route.html)

在调试器的`AppData`查看当前活动页面，

使用 `getCurrentPages()` 函数获取当前页面栈 

| 路由方式   | 页面栈表现                      | 方法                        | 当前页面 | 后页面        |
| ---------- | ------------------------------- | --------------------------- | -------- | ------------- |
| 打开新页面 | 新页面入栈                      | wx.navigateTo               | onHide   | onLoad,onShow |
| 页面返回   | 页面不断出栈，直到目标返回页    | 左上角返回，wx.navigateBack | onUnload | onShow        |
| Tab切换    | 页面全部出栈，只留下新的Tab页面 | wx.switchTab                |          |               |

1. Tab栏只会初始化第一个页面，第一次切换到某tab时才会初始化该Tab; 后续切换tab只会显示/隐藏

2. 只有一个tab栏会入栈

3. tab栏只要初始化了并不会销毁

   

#### 04.小程序和uniapp生命周期图

[小程序的生命周期](https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/page-life-cycle.html)

[uniapp的生命周期](https://uniapp.dcloud.io/collocation/frame/lifecycle)

1. uniapp应用生命周期和小程序一致
2. uniapp页面生命周期和小程序一致，不建议用vue的生命周期
3. uniapp组件的生命周期建议用vue的生命周期

#### 05.场景值

[传送门](https://developers.weixin.qq.com/miniprogram/dev/reference/scene-list.html)

概念：小程序的入口，不同入口都有的标识，这个就是场景值

一般用作**事件上报**

1. 页面被访问的次数PV
2. 页面被不同用户访问的次数UV
3. 事件上报针对某一按钮

获取场景值：app.js onShow(){options. scene }



## 优购案例-搜索列表

#### 07. 搜索和过滤栏固定定位，不随着商品列表滚动

[onPageScroll](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onPageScroll-Object-object)

1. 上滑时，搜索和过滤栏不随商品列表滚动
   1. onPageScroll：isFixed=true
2. 下拉刷新顶部loading
   1. onPullDownRefresh：isFixed:false

## 优购案例-搜索列表

#### 08.无须在结构渲染的变量不要声明在data里面

1. pageNum
2. isRequest

#### 09.自测

1. 输入框输入关键字，商品列表展示第一页搜索商品
2. 下拉刷新，商品列表展示第一页搜索商品
3. 上拉加载，加载下一页商品
4. 分类页点击三级分类，输入框显示对应的三级分类的名称，商品列表展示第一页搜索数据

#### 10.提取公共样式

1. 一般公共样式直接放在App.vue
2. 如果声明less变量的话
   1. less变量的作用域是单文件内的
   2. 一般提取全局less文件，哪个文件需要用，就引入全局的less





## 总结

## 作业